---
title: "Untitled"
author: "Nancy"
date: "`r Sys.Date()`"
output: html_document
---
Title:
Analysis of Severe Weather Events: Impact on Population Health and Economic Consequences in the United States

1. Introduction
This report analyzes severe weather events across the United States, focusing on their impact on population health and economic consequences. The analysis aims to help government and municipal managers prioritize resources for different types of events.



Synopsis:
This report analyzes the NOAA Storm Database to identify the types of severe weather events that are most harmful to population health and those with the greatest economic impact across the United States. The analysis focuses on understanding the effects of different event types on fatalities, injuries, property damage, and crop damage. Tornadoes are identified as the most harmful events to population health, causing the highest number of fatalities and injuries. Floods and hurricanes/typhoons are identified as having the greatest economic consequences due to their significant impact on property and crops. The findings provide valuable insights for resource allocation and preparedness strategies.



```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r }
library(dplyr)
library(ggplot2)
library(readr)
```

#1. Load and Prepare the Data
Loading and Preparing the Data
The first step involves loading the NOAA Storm Database into R and performing necessary data preprocessing, such as subsetting relevant columns and cleaning the data.

```{r}

# Load the data
url <- "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2"
download.file(url, destfile = "StormData.csv.bz2")
storm_data <- read.csv("StormData.csv.bz2")

# Select relevant columns
storm_data <- storm_data %>%
  select(EVTYPE, FATALITIES, INJURIES, PROPDMG, PROPDMGEXP, CROPDMG, CROPDMGEXP)

# Convert PROPDMGEXP and CROPDMGEXP to actual values
convert_exp <- function(x) {
  ifelse(x == "K", 1e3,
         ifelse(x == "M", 1e6,
                ifelse(x == "B", 1e9, 1)))
}

storm_data$PROPDMG <- storm_data$PROPDMG * convert_exp(storm_data$PROPDMGEXP)
storm_data$CROPDMG <- storm_data$CROPDMG * convert_exp(storm_data$CROPDMGEXP)
```

# Aggregating the Data
Next, we aggregate the data to calculate the total fatalities, injuries, property damage, and crop damage for each event type.


# Aggregate data for population health
health_impact <- storm_data %>%
  group_by(EVTYPE) %>%
  summarize(Total_Fatalities = sum(FATALITIES),
            Total_Injuries = sum(INJURIES)) %>%
  arrange(desc(Total_Fatalities, Total_Injuries))

# Aggregate data for economic consequences
economic_impact <- storm_data %>%
  group_by(EVTYPE) %>%
  summarize(Total_Prop_Damage = sum(PROPDMG),
            Total_Crop_Damage = sum(CROPDMG),
            Total_Economic_Damage = Total_Prop_Damage + Total_Crop_Damage) %>%
  arrange(desc(Total_Economic_Damage))
2. Results
2.1. Most Harmful Events to Population Health
The first question focuses on identifying the types of events most harmful to population health. We assess this by analyzing the total number of fatalities and injuries caused by each event type.


# Top 10 most harmful events to population health
top_health_impact <- health_impact %>% top_n(10, Total_Fatalities + Total_Injuries)

# Plot the results
ggplot(top_health_impact, aes(x = reorder(EVTYPE, -Total_Fatalities), y = Total_Fatalities)) +
  geom_bar(stat = "identity", fill = "red") +
  geom_text(aes(label = Total_Fatalities), vjust = -0.5, color = "black") +
  labs(title = "Top 10 Most Harmful Weather Events to Population Health",
       x = "Event Type", y = "Total Fatalities") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
2.2. Events with Greatest Economic Consequences
The second question focuses on identifying events with the greatest economic impact, which includes property damage and crop damage.


# Top 10 events with the greatest economic consequences
top_economic_impact <- economic_impact %>% top_n(10, Total_Economic_Damage)

# Plot the results
ggplot(top_economic_impact, aes(x = reorder(EVTYPE, -Total_Economic_Damage), y = Total_Economic_Damage)) +
  geom_bar(stat = "identity", fill = "blue") +
  geom_text(aes(label = round(Total_Economic_Damage / 1e9, 2)), vjust = -0.5, color = "black") +
  labs(title = "Top 10 Weather Events with Greatest Economic Consequences",
       x = "Event Type", y = "Total Economic Damage (in billions)") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
3. Conclusion
Most Harmful Events to Population Health: Tornadoes are by far the most harmful, causing the highest number of fatalities and injuries. Other significant events include excessive heat, flash floods, and lightning.

Events with Greatest Economic Consequences: Floods, hurricanes/typhoons, and tornadoes cause the greatest economic damage, primarily through property damage, with significant contributions from crop damage in some events.



# 2. Data Cleaning and Preprocessing
We'll need to clean the data by focusing on relevant columns and handling any inconsistencies.
2. Data Preparation
The NOAA Storm Database was used, focusing on event types (EVTYPE), fatalities, injuries, and property and crop damages.

```{r}
# Select relevant columns for analysis
storm_data <- storm_data %>%
  select(EVTYPE, FATALITIES, INJURIES, PROPDMG, PROPDMGEXP, CROPDMG, CROPDMGEXP)

# Convert damage exponents to numeric values
convert_exp <- function(exp) {
  ifelse(exp %in% c('B', 'b'), 1e9,
  ifelse(exp %in% c('M', 'm'), 1e6,
  ifelse(exp %in% c('K', 'k'), 1e3,
  ifelse(exp %in% c('H', 'h'), 1e2, 1))))
}

storm_data <- storm_data %>%
  mutate(PROPDMGEXP = convert_exp(PROPDMGEXP),
         CROPDMGEXP = convert_exp(CROPDMGEXP),
         PROPDMG = PROPDMG * PROPDMGEXP,
         CROPDMG = CROPDMG * CROPDMGEXP)

# Summarize by event type
health_impact <- storm_data %>%
  group_by(EVTYPE) %>%
  summarize(total_fatalities = sum(FATALITIES),
            total_injuries = sum(INJURIES),
            total_health_impact = total_fatalities + total_injuries) %>%
  arrange(desc(total_health_impact))

economic_impact <- storm_data %>%
  group_by(EVTYPE) %>%
  summarize(total_property_damage = sum(PROPDMG),
            total_crop_damage = sum(CROPDMG),
            total_economic_impact = total_property_damage + total_crop_damage) %>%
  arrange(desc(total_economic_impact))
```

#3. Identify the Most Harmful Events for Population Health
We'll focus on events with the highest combined fatalities and injuries.
3. Most Harmful Events to Population Health
The analysis identified the top 10 event types most harmful to population health, considering both fatalities and injuries:

```{r}
# Top 10 most harmful events to population health
top_health_events <- head(health_impact, 10)

# Plot the results
ggplot(top_health_events, aes(x = reorder(EVTYPE, -total_health_impact), y = total_health_impact)) +
  geom_bar(stat = "identity", fill = "red") +
  coord_flip() +
  labs(title = "Top 10 Most Harmful Events to Population Health",
       x = "Event Type",
       y = "Total Health Impact (Fatalities + Injuries)")
```
# 4. Identify Events with the Greatest Economic Consequences
We'll look at the events with the highest property and crop damage combined.

4. Events with the Greatest Economic Consequences
The analysis also identified the top 10 event types with the greatest economic consequences, based on property and crop damage:


```{r}
# Top 10 events with the greatest economic consequences
top_economic_events <- head(economic_impact, 10)

# Plot the results
ggplot(top_economic_events, aes(x = reorder(EVTYPE, -total_economic_impact), y = total_economic_impact)) +
  geom_bar(stat = "identity", fill = "blue") +
  coord_flip() +
  labs(title = "Top 10 Events with the Greatest Economic Consequences",
       x = "Event Type",
       y = "Total Economic Impact (Property + Crop Damage)")
```


5. Conclusion
The results show that certain types of severe weather events, such as tornadoes and floods, have a significant impact on both population health and the economy. These findings can inform resource allocation and preparedness strategies.

